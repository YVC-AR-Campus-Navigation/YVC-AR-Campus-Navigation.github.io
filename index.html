<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YVC Indoor AR Navigation</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <!-- MindAR -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.4/dist/mindar-image-aframe.prod.js"></script>
  <style>
.landmark{
  font-size: 0.9em;
  opacity: 0.75;
  margin-top: 6px;
}

.stepFlash{
  animation: stepFlash 0.18s ease-in-out;
}

@keyframes stepFlash{
  from { transform: scale(0.985); opacity: 0.6; }
  to   { transform: scale(1);     opacity: 1; }
}
</style>
</head>

<body style="margin:0; overflow:hidden;">

  <!-- ================= AR SCENE ================= -->
  <a-scene
    mindar-image="imageTargetSrc: ./targets.mind;"
    color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
  >

    <a-assets></a-assets>

    <!-- Poster Target -->
    <a-entity id="target0" mindar-image-target="targetIndex: 0">

   <a-entity id="navArrow" position="0 0 0" visible="false">

  <!-- Shaft -->
  <a-box
    position="0 0.12 0"
    width="0.08"
    height="0.24"
    depth="0.02"
    material="shader: flat; color: yellow">
  </a-box>

  <!-- Head -->
  <a-cone
    position="0 0.28 0"
    radius-bottom="0.10"
    radius-top="0.001"
    height="0.16"
    material="shader: flat; color: yellow">
  </a-cone>

</a-entity>





    </a-entity>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
  </a-scene>

  <!-- ================= UI OVERLAY ================= -->
  <div id="uiOverlay" style="
    position:fixed; left:0; top:0; right:0; bottom:0;
    display:flex; justify-content:center; align-items:flex-end;
    padding:16px; z-index:9999;
    font-family:Arial; pointer-events:none;
  ">
    <div id="uiCard" style="
      width:min(560px, 100%);
      background:rgba(0,0,0,0.8);
      color:white;
      border-radius:16px;
      padding:16px;
      pointer-events:auto;
      display:none;
    ">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span id="trackingStatus">Looking for poster…</span>
        <button id="btnClose">X</button>
      </div>

      <!-- HOME -->
      <div id="screenHome">
        <h3>Choose a destination</h3>
        <button data-dest="library">Library</button>
        <button data-dest="hub">HUB</button>
        <button data-dest="bookstore">Bookstore</button>
      </div>

      <!-- ROUTE -->
      <div id="screenRoute" style="display:none;">
        <h3 id="routeTitle">Route</h3>
        <div>
          Step <span id="stepIndex">1</span> of <span id="stepTotal">1</span>
        </div>
        <div id="stepText" style="margin:10px 0;"></div>
<div id="landmarkText" class="landmark"></div>
        <button id="btnBack">Back</button>
        <button id="btnNext">Next</button>
        <button id="btnHome">Home</button>
      </div>
    </div>
  </div>

  <!-- ================= JAVASCRIPT ================= -->
  <script>
    const routes = {
  library: [
    { text: "Walk straight down the hallway.", landmark: "Main hallway" },
    { text: "Turn left at the stairs.", landmark: "Stairwell" },
    { text: "Enter the Library.", landmark: "Library entrance" }
  ],

  hub: [
    { text: "Walk forward.", landmark: "Main hallway" },
    { text: "Follow signs to HUB.", landmark: "HUB sign" },
    { text: "Enter the HUB.", landmark: "HUB entrance" }
  ],

  bookstore: [
    { text: "Walk forward.", landmark: "Main corridor" },
    { text: "Look for Bookstore signs.", landmark: "Bookstore sign" },
    { text: "Enter Bookstore.", landmark: "Bookstore entrance" }
  ]
};
const arrowDirections = {
  library: ["forward", "left", "forward"],
  hub: ["forward", "right", "forward"],
  bookstore: ["forward", "forward", "left"]
};

    const uiCard = document.getElementById("uiCard");
    const trackingStatus = document.getElementById("trackingStatus");

    const screenHome = document.getElementById("screenHome");
    const screenRoute = document.getElementById("screenRoute");

    const routeTitle = document.getElementById("routeTitle");
    const stepIndex = document.getElementById("stepIndex");
    const stepTotal = document.getElementById("stepTotal");
    const stepText = document.getElementById("stepText");
const landmarkText = document.getElementById("landmarkText");
    const btnBack = document.getElementById("btnBack");
    const btnNext = document.getElementById("btnNext");
    const btnHome = document.getElementById("btnHome");
    const btnClose = document.getElementById("btnClose");

    const navArrow = document.getElementById("navArrow");
    const target0 = document.getElementById("target0");

    let currentDest = null;
    let currentStep = 0;

    function showCard() {
      uiCard.style.display = "block";
    }

    function hideCard() {
      uiCard.style.display = "none";
    }

    function showHome() {
      screenHome.style.display = "block";
      screenRoute.style.display = "none";
      navArrow.setAttribute("visible", false);
      currentDest = null;
      currentStep = 0;
    }

    function showRoute() {
      screenHome.style.display = "none";
      screenRoute.style.display = "block";
    }
function setArrowDirection(dir) {
  if (dir === "forward") navArrow.setAttribute("rotation", "0 0 0");
  if (dir === "left")    navArrow.setAttribute("rotation", "0 0 90");
  if (dir === "right")   navArrow.setAttribute("rotation", "0 0 -90");
  if (dir === "back")    navArrow.setAttribute("rotation", "0 0 180");
}

    function loadDest(dest) {
      currentDest = dest;
      currentStep = 0;

      navArrow.setAttribute("visible", true);

      routeTitle.textContent = dest.toUpperCase();
      stepTotal.textContent = routes[dest].length;
      renderStep();
      showRoute();
    }

    function renderStep() {
      stepIndex.textContent = currentStep + 1;
     const stepObj = routes[currentDest][currentStep];
stepText.textContent = stepObj.text;
landmarkText.textContent = "Landmark: " + stepObj.landmark;
      screenRoute.classList.remove("stepFlash");
void screenRoute.offsetWidth;
screenRoute.classList.add("stepFlash");
      const dir = (arrowDirections[currentDest] || [])[currentStep] || "forward";
setArrowDirection(dir);

      btnBack.disabled = currentStep === 0;
     btnNext.textContent =
  currentStep === routes[currentDest].length - 1 ? "Arrived" : "I’m Here";
    }

    document.querySelectorAll("[data-dest]").forEach(btn => {
      btn.addEventListener("click", () => loadDest(btn.dataset.dest));
    });

    btnBack.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        renderStep();
      }
    });

    btnNext.addEventListener("click", () => {
      if (currentStep < routes[currentDest].length - 1) {
        currentStep++;
        renderStep();
      } else {
        showHome();
      }
    });

    btnHome.addEventListener("click", showHome);
    btnClose.addEventListener("click", hideCard);

    target0.addEventListener("targetFound", () => {
      trackingStatus.textContent = "Poster detected ✅";
      showCard();
    });

    target0.addEventListener("targetLost", () => {
      trackingStatus.textContent = "Looking for poster…";
    });
  </script>

</body>
</html>
